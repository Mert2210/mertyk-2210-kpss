<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MYK 2210 - KPSS Platformu</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#1e3c72">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        /* --- GENEL SAYFA YAPISI --- */
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); 
            color: #fff; 
            text-align: center; 
            margin: 0; 
            display: flex; 
            justify-content: center; 
            align-items: flex-start; 
            min-height: 100vh; 
            overflow-y: auto; 
            padding: 20px 0; 
        }

        .container { 
            background: rgba(255,255,255,0.95); 
            color: #333; 
            width: 95%; 
            max-width: 450px; 
            padding: 20px; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); 
            position: relative; 
            margin-bottom: 20px; 
        }

        h1, h2, h3 { margin-top: 0; color: #1e3c72; }
        
        input, select, button { width: 100%; padding: 12px; margin-bottom: 8px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; font-size: 1rem; }
        button { background: #1e3c72; color: white; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }
        button.green { background: #27ae60; }
        button.orange { background: #e67e22; }
        button.red { background: #c0392b; }
        button.purple { background: #8e44ad; }
        button.outline { background: transparent; border: 2px solid #1e3c72; color: #1e3c72; }

        .screen { display: none; } 
        .active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- Lƒ∞STE ELEMANLARI --- */
        .list-item { background: #fff; border-bottom: 2px solid #f0f2f5; padding: 12px; text-align: left; font-size: 0.85rem; }
        .list-item .q-text { font-weight: bold; color: #333; display: block; margin-bottom: 5px; }
        .list-item .ans-text { color: #27ae60; font-weight: bold; font-size: 0.8rem; background: #e8f5e9; padding: 4px; border-radius: 4px; display: inline-block; }
        
        .player-card { background: #f0f2f5; padding: 8px; margin: 4px 0; border-radius: 5px; display: flex; justify-content: space-between; font-size: 0.9rem; font-weight: bold; }
        .opt-btn { background: #eef2f3; color: #333; text-align: left; border: 2px solid #ddd; width: 100%; margin-bottom: 8px; cursor: pointer; }
        .opt-btn:hover { background-color: #e0e0e0; }
        .correct { background: #2ecc71 !important; color: white; border-color: #27ae60; }
        .wrong { background: #e74c3c !important; color: white; border-color: #c0392b; }

        #timer-bar { height: 6px; background: #e67e22; width: 100%; margin-top: 10px; border-radius: 3px; }
        .badge { background: #e67e22; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; }
        #q-image { width: 100%; max-height: 180px; object-fit: contain; margin-bottom: 10px; display: none; border-radius: 8px; }
        
        #star-btn { font-size: 1.5rem; background: none; border: none; color: #ccc; width: auto; cursor: pointer; padding: 0; line-height: 1; }
        #star-btn.starred { color: #f1c40f; text-shadow: 0 0 5px rgba(241,196,15,0.5); }
        
        #live-scores-container { margin-top: 15px; border-top: 2px solid #eee; padding-top: 10px; }
        #btn-sound-toggle { font-size: 0.8rem; padding: 5px; margin-top: 10px; }

        /* --- SONU√á KARTLARI --- */
        .review-card { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 15px; text-align: left; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .review-q { font-weight: bold; margin-bottom: 10px; color: #1e3c72; }
        .review-row { display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 5px; }
        .review-user-ans { font-weight: bold; }
        .review-correct-ans { color: #27ae60; font-weight: bold; }
        .text-green { color: #27ae60; }
        .text-red { color: #c0392b; }
        .review-solution { background: #fff3cd; color: #856404; padding: 10px; border-radius: 5px; font-size: 0.85rem; margin-top: 10px; border-left: 4px solid #ffeeba; }

        .analysis-card { background: #f8f9fa; border-radius: 8px; padding: 10px; margin-top: 10px; text-align: left; border: 1px solid #e9ecef; }
        .analysis-item { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px dashed #ddd; font-size: 0.85rem; }
        .analysis-item:last-child { border-bottom: none; }

        /* --- SORU NAVƒ∞GASYONU --- */
        #question-navigator { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-top: 15px; padding: 10px; background: #f1f2f6; border-radius: 8px; border: 1px solid #ddd; }
        .nav-box { width: 30px; height: 30px; display: flex; justify-content: center; align-items: center; background: #fff; border: 1px solid #ccc; border-radius: 4px; cursor: pointer; font-size: 0.8rem; font-weight: bold; color: #555; transition: 0.2s; }
        .nav-box:hover { background: #e0e0e0; }
        .nav-box.active { border: 2px solid #e67e22; transform: scale(1.1); box-shadow: 0 0 5px rgba(230, 126, 34, 0.5); }
        .nav-box.answered { background: #3498db; color: white; border-color: #2980b9; }
        .nav-box.correct { background: #27ae60; color: white; border-color: #2ecc71; }
        .nav-box.wrong { background: #c0392b; color: white; border-color: #e74c3c; }

        #nav-buttons { display: flex; justify-content: space-between; margin-top: 15px; gap: 15px; }
        .nav-btn { flex: 1; padding: 12px; border: none; border-radius: 12px; font-size: 0.95rem; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .nav-btn.prev { background-color: #f8f9fa; color: #7f8c8d; border: 1px solid #eef2f3; }
        .nav-btn.prev:hover { background-color: #ecf0f1; transform: translateY(-2px); color: #34495e; }
        .nav-btn.next { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; box-shadow: 0 4px 15px rgba(30, 60, 114, 0.3); }
        .nav-btn.next:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(30, 60, 114, 0.4); filter: brightness(1.1); }

        .home-btn { background: none; border: none; font-size: 1.3rem; cursor: pointer; transition: 0.2s; padding: 5px; border-radius: 50%; }
        .home-btn:hover { background-color: rgba(0,0,0,0.05); transform: scale(1.1); }
        #report-btn { font-size: 1.2rem; background: none; border: none; cursor: pointer; padding: 0; line-height: 1; margin-left: 5px; }
        #report-btn:hover { transform: scale(1.1); }

        /* --- A√áILIR KAPANIR MEN√úLER --- */
        .dropdown-wrapper { position: relative; margin-bottom: 8px; width: 100%; }
        .dropdown-trigger { background-color: #fff; color: #333; border: 2px solid #e67e22; padding: 12px; width: 100%; text-align: left; border-radius: 8px; cursor: pointer; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .dropdown-trigger::after { content: '‚ñº'; font-size: 0.8rem; }
        .dropdown-trigger.open::after { content: '‚ñ≤'; }
        .dropdown-trigger.subject-trigger { border-color: #2980b9; }
        .dropdown-content { display: none; position: absolute; background-color: #fff; width: 100%; border: 1px solid #ccc; border-radius: 8px; box-shadow: 0 8px 16px rgba(0,0,0,0.2); z-index: 100; max-height: 200px; overflow-y: auto; left: 0; }
        .dropdown-content.down { top: 100%; margin-top: 5px; }
        .dropdown-content.up { bottom: 100%; margin-bottom: 5px; top: auto; }
        .dropdown-content.show { display: block; }
        .checkbox-item { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #f0f0f0; cursor: pointer; }
        .checkbox-item:last-child { border-bottom: none; }
        .checkbox-item:hover { background-color: #f9f9f9; }
        .checkbox-item input { width: auto; margin: 0 10px 0 0; cursor: pointer; transform: scale(1.2); }
        .checkbox-item label { cursor: pointer; font-size: 0.9rem; flex: 1; text-align: left; color: #333; margin: 0; }
        .selection-label { font-size:0.7rem; color:#666; display:block; margin-bottom:2px; text-align:left; }

        /* --- Kƒ∞BAR R√úTBE KARTI --- */
        #rank-display {
            background: linear-gradient(to right, #f1c40f, #f39c12);
            color: white;
            padding: 8px 12px;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            text-align: left;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s;
        }
        #rank-display:hover { transform: translateY(-2px); }
        
        #rank-title { font-weight: bold; font-size: 1rem; display: block; text-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        #total-points-display { font-size: 0.8rem; float:right; background:rgba(0,0,0,0.25); padding:2px 8px; border-radius:10px; margin-top: -20px; }
        
        /* ƒ∞nce ƒ∞lerleme √áubuƒüu */
        .progress-container { width: 100%; background-color: rgba(255,255,255,0.3); border-radius: 5px; margin-top: 6px; height: 6px; overflow: hidden; }
        .progress-bar { height: 100%; background-color: #fff; width: 0%; transition: width 0.8s ease-in-out; }
        .next-level-info { font-size: 0.7rem; margin-top: 3px; opacity: 0.95; text-align: right; }

        /* R√ºtbe Tablosu Popup */
        #rank-table-modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; color: #333; padding: 20px; border-radius: 15px; box-shadow: 0 0 30px rgba(0,0,0,0.6); z-index: 200; width: 85%; max-width: 320px; animation: popIn 0.3s; }
        @keyframes popIn { from { transform: translate(-50%, -60%); opacity: 0; } to { transform: translate(-50%, -50%); opacity: 1; } }
        
        .rank-row { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding: 8px 5px; font-size: 0.9rem; }
        .rank-row.active { color: #e67e22; font-weight: bold; background-color: #fff8e1; border-radius: 5px; }
    </style>
</head>
<body>

<audio id="snd-correct" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3" preload="auto"></audio>
<audio id="snd-wrong" src="https://assets.mixkit.co/active_storage/sfx/2021/2021-preview.mp3" preload="auto"></audio>

<div id="rank-table-modal">
    <h3 style="text-align:center; border-bottom:2px solid #e67e22; padding-bottom:10px; margin-top:0;">üìä R√ºtbe ve Puan Sistemi</h3>
    <div id="rank-table-content"></div>
    <div style="text-align:center; margin-top:15px;">
        <button onclick="document.getElementById('rank-table-modal').style.display='none'" class="red" style="width:auto; padding:8px 20px; border-radius:20px;">Kapat</button>
    </div>
</div>

<div class="container">
    <div id="screen-login" class="screen active">
        <h1 style="margin: 0; color: #e67e22; letter-spacing: 2px; font-size: 2.5rem;">MYK 2210</h1>
        <h3 style="margin: 5px 0 15px 0; font-weight: normal; font-size: 0.9rem; opacity: 0.9; color: #1e3c72;">KPSS SORU √á√ñZME YARI≈ûMASI</h3>
        
        <div id="rank-display" onclick="document.getElementById('rank-table-modal').style.display='block'" title="Puan tablosunu g√∂rmek i√ßin tƒ±kla">
            <div>
                <span id="rank-title">‚≠ê 1. Seviye</span>
                <span id="total-points-display">0 Puan</span>
            </div>
            <div class="progress-container">
                <div class="progress-bar" id="rank-progress"></div>
            </div>
            <div class="next-level-info" id="next-rank-info">Sonraki Seviye: 300 Puan</div>
        </div>
        
        <input type="text" id="username" placeholder="Adƒ±nƒ±z">
        <button onclick="startTrial()" class="purple">üìù HIZLI DENEME √á√ñZ</button>
        <button onclick="createRoom()">üè† ODA KUR (ARKADA≈ûINLA)</button>
        
        <div style="display:flex; gap:5px;">
            <input type="number" id="room-code-input" placeholder="Oda Kodu">
            <button onclick="joinRoom()" class="green" style="width:60%;">KATIL</button>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px; margin-top:5px;">
            <button onclick="showLocalList('fav')" class="outline" style="font-size:0.75rem;">‚≠ê Yƒ±ldƒ±zlƒ±lar</button>
            <button onclick="showLocalList('wrong')" class="outline" style="font-size:0.75rem;">‚ùå Yanlƒ±≈ülar</button>
            <button onclick="showLocalList('blank')" class="outline" style="font-size:0.75rem;">‚ö™ Bo≈ülarƒ±m</button>
            <button onclick="startMistakesTrial()" class="red" style="font-size:0.75rem;">üß† Hata Sƒ±navƒ±</button>
        </div>
        
        <button id="btn-sound-toggle" onclick="toggleSound()" class="outline" style="margin-top:10px;">üîä SES: A√áIK</button>
    </div>

    <div id="screen-list" class="screen">
        <div style="display:flex; justify-content:space-between; align-items:center;">
             <h3 id="list-title">Liste</h3>
             <button id="pdf-btn" onclick="downloadPDF()" class="orange" style="width:auto; padding:5px 10px; font-size:0.8rem; display:none;">üìÑ PDF ƒ∞ndir</button>
        </div>
        <div id="list-content" style="max-height: 350px; overflow-y: auto;"></div>
        <button onclick="clearList()" class="red" style="margin-top:10px;">Listeyi Temizle</button>
        <button onclick="showScreen('screen-login')" class="outline">ANA MEN√ú</button>
    </div>

    <div id="screen-lobby" class="screen">
        <p id="room-info-text">Oda Kodu:</p>
        <h1 id="display-room-code" style="color:#e67e22; margin:0;">----</h1>
        <div id="lobby-list" style="margin-top:10px;"></div>
        
        <div id="host-controls" style="display:none; margin-top:20px; background: #f9f9f9; padding: 15px; border-radius: 10px;">
            <h3 style="font-size: 1rem; margin-bottom: 10px;">Sƒ±nav Ayarlarƒ±</h3>
            <div style="display:flex; gap:5px; align-items: flex-end; margin-bottom: 8px;">
                <div style="flex:1;">
                    <span style="font-size:0.7rem; color:#666;">S√ºre Modu</span>
                    <select id="set-timer-mode" onchange="toggleTimerInput()" style="font-size:0.8rem; padding:8px;">
                        <option value="question">Soru Ba≈üƒ±na (Saniye)</option>
                        <option value="general">Genel Sƒ±nav (Dakika)</option>
                    </select>
                </div>
                <div style="flex:1;">
                    <span id="label-duration" style="font-size:0.7rem; color:#666;">S√ºre (Sn)</span>
                    <input type="number" id="set-duration" value="20" style="padding:8px;">
                </div>
            </div>
            <div style="display:flex; gap:5px; align-items: flex-end; margin-bottom: 8px;">
                <div style="flex:1;">
                    <span style="font-size:0.7rem; color:#666;">Soru Sayƒ±sƒ±</span>
                    <input type="number" id="set-count" value="10" style="padding:8px;">
                </div>
            </div>
            <span class="selection-label">Soru Se√ßimi:</span>
            <div class="dropdown-wrapper">
                <div class="dropdown-trigger" onclick="toggleDropdown('deneme-content', this)">Y√ºkleniyor...</div>
                <div id="deneme-content" class="dropdown-content down"></div>
            </div>
            <span class="selection-label">Dersler:</span>
            <div class="dropdown-wrapper">
                <div class="dropdown-trigger subject-trigger" onclick="toggleDropdown('subject-content', this)">Y√ºkleniyor...</div>
                <div id="subject-content" class="dropdown-content up"></div>
            </div>
            <select id="set-difficulty">
                <option value="HEPSI">T√ºm Seviyeler</option>
                <option value="KOLAY">Kolay</option>
                <option value="ORTA">Orta</option>
                <option value="ZOR">Zor</option>
                <option value="√áIKMI≈û">üî• Sadece √áƒ±kmƒ±≈ü Sorular</option>
            </select>
            <select id="set-sik-sayisi" style="border: 2px solid #2980b9; color: #2980b9; font-weight:bold;">
                <option value="HEPSI">Karƒ±≈üƒ±k (T√ºm Sorular)</option>
                <option value="4">Ba≈ülangƒ±√ß Sorularƒ± (4 ≈ûƒ±klƒ±)</option>
                <option value="5">Yeni Nesil Sorular (5 ≈ûƒ±klƒ±)</option>
            </select>
            <button onclick="startGame()" class="orange" style="margin-top:10px;">SINAVI BA≈ûLAT</button>
        </div>
        <p id="wait-msg" style="display:none; color:#777;">Kurucu ayarlarƒ± yapƒ±yor...</p>
    </div>

    <div id="screen-game" class="screen">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 10px;">
            <div style="display: flex; align-items: center; gap: 8px;">
                <button onclick="finishExamEarly()" class="home-btn" title="Sƒ±navƒ± Bitir">üèÅ</button>
                <span id="q-lesson" class="badge">DERS</span>
            </div>
            <div style="display: flex; align-items: center; gap: 5px;">
                <button id="report-btn" onclick="reportCurrentQuestion()" title="Hatalƒ± Soru Bildir">‚ö†Ô∏è</button>
                <button id="star-btn" onclick="toggleStar()">‚òÖ</button>
                <span id="q-count" style="font-weight:bold;">1/10</span>
            </div>
        </div>
        <div id="question-navigator" style="display:none;"></div> 
        <img id="q-image" src="">
        <h3 id="q-text" style="font-size:1.1rem; margin:15px 0; text-align: left;">Soru...</h3>
        <div id="opts-area"></div>
        <div id="nav-buttons" style="display:none;">
            <button onclick="navigateQuestion(-1)" class="nav-btn prev"><span>‚ùÆ</span> √ñnceki</button>
            <button onclick="navigateQuestion(1)" class="nav-btn next">Sonraki <span>‚ùØ</span></button>
        </div>
        <button id="btn-blank" onclick="submitBlank()" style="background:#95a5a6; margin-top:15px; width:100%; border-radius:8px;">‚ö™ BO≈û BIRAK</button>
        <div id="timer-bar"></div>
        <div id="general-timer-display" style="display:none; text-align:center; font-size:1.5rem; font-weight:bold; color:#1e3c72; margin-top:10px;">‚è±Ô∏è <span id="gen-timer-val">00:00</span></div>
        <div id="result-msg" style="height: 20px; margin-top: 10px; font-weight: bold; color: #e67e22;"></div>
        
        <div id="live-scores-container">
            <h4 style="margin:0 0 5px 0; font-size:0.8rem; color:#1e3c72; text-align:left; border-bottom: 1px solid #ddd;">üìä CANLI SKORLAR</h4>
            <div id="live-scores-list"></div>
        </div>
    </div>

    <div id="screen-result" class="screen">
        <h2>üèÜ SONU√áLAR</h2>
        <div id="result-board"></div> <div class="analysis-card" id="branch-analysis"></div>
        <br>
        <button onclick="showReviewScreen()" class="orange" style="margin-bottom: 10px;">üîç SORULARI ƒ∞NCELE & √á√ñZ√úMLER</button>
        <button onclick="location.reload()" class="outline">ANA MEN√úYE D√ñN</button>
    </div>

    <div id="screen-review" class="screen">
        <h3>üìù Soru √á√∂z√ºmleri</h3>
        <div id="review-content" style="max-height: 60vh; overflow-y: auto; padding-right: 5px;"></div>
        <button onclick="showScreen('screen-result')" class="outline" style="margin-top: 15px;">‚¨ÖÔ∏è SONU√áLARA D√ñN</button>
    </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io({ transports: ["polling", "websocket"] });
    let myCode = "", myButtons = [], currentQuestionData = null, currentListType = "";
    let isSoundEnabled = localStorage.getItem('kpss_sound') !== 'false';
    let isTrialMode = false, isMistakeMode = false, gameHistory = [];
    let questionStatusList = []; 
    let globalTimerInterval = null;

    // --- YENƒ∞: ZORLA≈ûTIRILMI≈û R√úTBE Sƒ∞STEMƒ∞ (3. Seviyeden sonra makas a√ßƒ±lƒ±yor) ---
    const rankLevels = [
        { name: "1. Seviye", limit: 300 },   // 0 - 300
        { name: "2. Seviye", limit: 650 },   // 300 - 650
        { name: "3. Seviye", limit: 1200 },  // 650 - 1200 (+550) - Makas A√ßƒ±ldƒ±
        { name: "4. Seviye", limit: 2000 },  // 1200 - 2000 (+800)
        { name: "5. Seviye", limit: 3000 },  // 2000 - 3000 (+1000)
        { name: "6. Seviye", limit: 4500 },  // 3000 - 4500 (+1500)
        { name: "7. Seviye", limit: 999999 } // 4500+ (Zirve)
    ];

    let totalUserPoints = parseInt(localStorage.getItem('kpss_total_points')) || 0;
    
    function updateRankDisplay() {
        const rankTitle = document.getElementById('rank-title');
        const pointsDisplay = document.getElementById('total-points-display');
        const progressBar = document.getElementById('rank-progress');
        const nextInfo = document.getElementById('next-rank-info');
        const tableContent = document.getElementById('rank-table-content');

        let currentRank = rankLevels[0];
        let prevLimit = 0;
        let nextLimit = rankLevels[0].limit;

        for (let i = 0; i < rankLevels.length; i++) {
            if (totalUserPoints < rankLevels[i].limit) {
                currentRank = rankLevels[i];
                nextLimit = rankLevels[i].limit;
                prevLimit = (i === 0) ? 0 : rankLevels[i-1].limit;
                break;
            } else if (i === rankLevels.length - 1) {
                currentRank = rankLevels[i];
                prevLimit = rankLevels[i-1].limit;
                nextLimit = totalUserPoints; 
            }
        }
        
        let percentage = 100;
        if(currentRank.name !== "7. Seviye") {
            const range = nextLimit - prevLimit;
            const current = totalUserPoints - prevLimit;
            percentage = Math.min(100, Math.max(0, (current / range) * 100));
            nextInfo.innerText = `Sonraki Seviye ƒ∞√ßin: ${nextLimit - totalUserPoints} Puan Kaldƒ±`;
        } else {
            nextInfo.innerText = "Zirvedesiniz! üëë";
        }

        rankTitle.innerText = "‚≠ê " + currentRank.name;
        pointsDisplay.innerText = totalUserPoints + " Puan";
        progressBar.style.width = percentage + "%";

        let html = "";
        let prev = 0;
        rankLevels.forEach((r, i) => {
            const isCurrent = r.name === currentRank.name ? "active" : "";
            const rangeText = (i === rankLevels.length - 1) ? `${prev}+` : `${prev} - ${r.limit}`;
            html += `<div class="rank-row ${isCurrent}"><span>${r.name}</span><span>${rangeText}</span></div>`;
            prev = r.limit;
        });
        tableContent.innerHTML = html;
    }

    function showScreen(id) { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
    function getUsername() { return document.getElementById('username').value || null; }
    
    window.onload = function() { 
        const savedName = localStorage.getItem('saved_username'); 
        if(savedName) document.getElementById('username').value = savedName; 
        updateSoundUI();
        updateRankDisplay(); 
    }

    function toggleSound() { isSoundEnabled = !isSoundEnabled; localStorage.setItem('kpss_sound', isSoundEnabled); updateSoundUI(); }
    function updateSoundUI() { document.getElementById('btn-sound-toggle').innerText = isSoundEnabled ? "üîä SES: A√áIK" : "üîá SES: KAPALI"; }
    function playSnd(id) { if(isSoundEnabled) document.getElementById(id).play().catch(()=>{}); }

    function getLocalData(key) { return JSON.parse(localStorage.getItem(key)) || []; }
    function saveLocalData(key, data) { localStorage.setItem(key, JSON.stringify(data)); }
    
    function saveToHistory(qData, listKey) {
        let list = getLocalData(listKey);
        const idx = list.findIndex(q => q.soru === qData.soru);
        if(idx === -1) { list.push({...qData}); saveLocalData(listKey, list); }
        else if (qData.dogru !== null) { list[idx] = {...qData}; saveLocalData(listKey, list); }
    }

    // --- GE√áMƒ∞≈û EKRANI (Buton olmasa da fonksiyonu saklƒ±yoruz) ---
    function showHistory() {
        const history = getLocalData('kpss_game_history');
        const content = document.getElementById('list-content');
        document.getElementById('list-title').innerText = "üìÖ Oyun Ge√ßmi≈üim";
        document.getElementById('pdf-btn').style.display = 'none';

        if(history.length === 0) {
            content.innerHTML = "<p style='padding:20px; color:#666;'>Hen√ºz hi√ß oyun oynamadƒ±nƒ±z.</p>";
        } else {
            content.innerHTML = history.reverse().map(game => 
                `<div class="list-item" style="border-left: 5px solid ${game.score >= 50 ? '#27ae60' : '#c0392b'};">
                    <span style="font-weight:bold; display:block;">${game.date}</span>
                    <span>Puan: ${game.score}</span> | <span>‚úÖ ${game.correct} - ‚ùå ${game.wrong}</span>
                 </div>`
            ).join('');
        }
        currentListType = 'history';
        showScreen('screen-list');
    }

    function showLocalList(type) {
        currentListType = type;
        const list = getLocalData(type==='fav'?'kpss_favs':(type==='wrong'?'kpss_wrongs':'kpss_blanks'));
        
        let title = "Liste";
        if(type === 'fav') title = "‚≠ê Yƒ±ldƒ±zlƒ±lar";
        else if(type === 'wrong') title = "‚ùå Yanlƒ±≈ülar";
        else if(type === 'blank') title = "‚ö™ Bo≈ülarƒ±m";

        document.getElementById('list-title').innerText = title;
        document.getElementById('pdf-btn').style.display = 'block'; // Hepsinde PDF indirilebilsin

        document.getElementById('list-content').innerHTML = list.length ? list.map((q, i) => 
            `<div class="list-item">
                <span class="q-text"><b>${i+1}.</b> ${q.soru}</span>
                <span class="ans-text">‚úÖ Doƒüru Cevap: ${q.siklar ? q.siklar[q.dogru] : '?'}</span>
             </div>`
        ).join('') : "<p>Kayƒ±t yok.</p>";
        showScreen('screen-list');
    }

    function downloadPDF() {
        const btn = document.getElementById('pdf-btn');
        const originalText = btn.innerText;
        btn.innerText = "Hazƒ±rlanƒ±yor...";
        
        let headerTitle = document.getElementById('list-title').innerText;
        const listContent = document.getElementById('list-content').innerHTML;
        const printWindow = window.open('', '', 'height=600,width=800');
        
        printWindow.document.write('<html><head><title>√áƒ±ktƒ± Al</title>');
        printWindow.document.write('<style>body{font-family:sans-serif; padding:20px;} .list-item{margin-bottom:20px; border-bottom:1px solid #ccc; padding-bottom:10px; page-break-inside: avoid;} .q-text{font-weight:bold; display:block; margin-bottom:5px; color:#333;} .ans-text{color:green; font-weight:bold;}</style>');
        printWindow.document.write('</head><body>');
        printWindow.document.write(`<h1 style="text-align:center; color:#1e3c72;">${headerTitle}</h1>`);
        printWindow.document.write(listContent);
        printWindow.document.write('</body></html>');
        printWindow.document.close();
        printWindow.focus();
        setTimeout(() => { printWindow.print(); btn.innerText = originalText; }, 500);
    }

    function clearList() { 
        if(currentListType === 'history') { if(confirm("T√ºm oyun ge√ßmi≈üin silinsin mi?")) { localStorage.removeItem('kpss_game_history'); showHistory(); } } 
        else { if(confirm("Bu liste silinsin mi?")) { localStorage.removeItem(currentListType==='fav'?'kpss_favs':(currentListType==='wrong'?'kpss_wrongs':'kpss_blanks')); showLocalList(currentListType); } }
    }

    function toggleStar() { if (!currentQuestionData) return; const btn = document.getElementById('star-btn'); let favs = getLocalData('kpss_favs'); const idx = favs.findIndex(q => q.soru === currentQuestionData.soru); if (idx > -1) { favs.splice(idx, 1); btn.classList.remove('starred'); } else { favs.push({...currentQuestionData}); btn.classList.add('starred'); } saveLocalData('kpss_favs', favs); }

    function reportCurrentQuestion() {
        if (!currentQuestionData) return;
        const reason = prompt("Bu sorudaki hata nedir?");
        if (reason) { socket.emit('reportQuestion', { soru: currentQuestionData.soru, deneme: currentQuestionData.deneme, reason: reason, username: getUsername() || "Anonim" }); alert("Te≈üekk√ºrler! Hata bildirimi alƒ±ndƒ±."); }
    }

    function createRoom() { const n = getUsername(); if(n) { localStorage.setItem('saved_username', n); socket.emit('createRoom', n); } else alert("ƒ∞sim giriniz!"); }
    function startTrial() { const n = getUsername(); if(n) { localStorage.setItem('saved_username', n); isTrialMode=true; socket.emit('createRoom', n); } else alert("ƒ∞sim giriniz!"); }
    
    function startMistakesTrial() { 
        const n = getUsername(); 
        const wrongs = getLocalData('kpss_wrongs'); 
        if(!n) return alert("ƒ∞sim giriniz!"); 
        if(wrongs.length < 3) return alert("En az 3 yanlƒ±≈ü sorunuz olmalƒ±!"); 
        localStorage.setItem('saved_username', n); 
        isTrialMode = true; 
        isMistakeMode = true; 
        
        // Hata modu i√ßin √∂zel ayar paketi g√∂nderiyoruz (Trim i≈ülemi Server'da yapƒ±lacak)
        const settings = {
            isMistakeMode: true,
            mistakeList: wrongs.map(q => q.soru), // Sadece soru metinlerini g√∂nder
            count: wrongs.length,
            timerMode: 'question',
            duration: 60,
            subject: "HEPSI"
        };
        
        socket.emit('startGame', { roomCode: myCode, settings: settings }); 
    }

    function joinRoom() { const n = getUsername(), c = document.getElementById('room-code-input').value; if(n && c) { localStorage.setItem('saved_username', n); myCode = c; socket.emit('joinRoom', {username:n, roomCode:c}); } }
    
    function toggleTimerInput() { const mode = document.getElementById('set-timer-mode').value; const label = document.getElementById('label-duration'); const input = document.getElementById('set-duration'); if(mode === 'general') { label.innerText = "Toplam S√ºre (Dakika)"; input.value = "30"; } else { label.innerText = "Soru Ba≈üƒ±na (Saniye)"; input.value = "20"; } }
    
    function toggleDropdown(id, trigger) { document.querySelectorAll('.dropdown-content').forEach(el => { if(el.id !== id) el.classList.remove('show'); }); document.querySelectorAll('.dropdown-trigger').forEach(el => { if(el !== trigger) el.classList.remove('open'); }); const content = document.getElementById(id); content.classList.toggle('show'); trigger.classList.toggle('open'); }
    
    // --- G√úNCELLENMƒ∞≈û TOPLAM SORU SAYISI G√ñSTERƒ∞Mƒ∞ ---
    function updateTriggerText(containerId, allLabel) {
        const container = document.getElementById(containerId); const trigger = container.previousElementSibling; const checked = container.querySelectorAll('input[type="checkbox"]:not([id$="-all"]):checked'); const total = container.querySelectorAll('input[type="checkbox"]:not([id$="-all"])').length;
        
        if (checked.length === 0) { trigger.innerText = "L√ºtfen Se√ßim Yapƒ±nƒ±z"; trigger.style.color = "#e74c3c"; container.querySelector('input[id$="-all"]').checked = false; }
        else if (checked.length === total) { 
            // Sadece Kaynak Se√ßimi ise sayƒ± g√∂ster
            if(containerId === 'deneme-content') {
                let totalQ = 0; container.querySelectorAll('label').forEach(lbl => { const match = lbl.innerText.match(/\((\d+)/); if(match) totalQ += parseInt(match[1]); });
                trigger.innerText = allLabel + ` (Toplam ${totalQ} Soru)`; 
            } else {
                trigger.innerText = allLabel + " (Hepsi Se√ßili)";
            }
            trigger.style.color = "#333"; container.querySelector('input[id$="-all"]').checked = true; 
        }
        else if (checked.length <= 2) { const names = Array.from(checked).map(cb => container.querySelector(`label[for="${cb.id}"]`).innerText.replace(/\s*\(\d+ Soru\)/, "").replace("‚ú® ", "")).join(", "); trigger.innerText = names; trigger.style.color = "#333"; container.querySelector('input[id$="-all"]').checked = false; }
        else { trigger.innerText = `${checked.length} Kaynak Se√ßildi`; trigger.style.color = "#333"; container.querySelector('input[id$="-all"]').checked = false; }
    }
    window.onclick = function(event) { if (!event.target.matches('.dropdown-trigger') && !event.target.closest('.dropdown-content')) { document.querySelectorAll('.dropdown-content').forEach(el => el.classList.remove('show')); document.querySelectorAll('.dropdown-trigger').forEach(el => el.classList.remove('open')); } }

    function startGame() { 
        const secilenDenemeler = []; document.querySelectorAll('input[name="deneme-secim"]:checked').forEach(cb => secilenDenemeler.push(cb.value)); const denemeValue = secilenDenemeler.length > 0 ? secilenDenemeler : "HEPSI";
        const secilenDersler = []; document.querySelectorAll('input[name="subject-secim"]:checked').forEach(cb => secilenDersler.push(cb.value)); const dersValue = secilenDersler.length > 0 ? secilenDersler : "HEPSI";
        let settings = { deneme: denemeValue, count: document.getElementById('set-count').value, timerMode: document.getElementById('set-timer-mode').value, duration: document.getElementById('set-duration').value, subject: dersValue, difficulty: document.getElementById('set-difficulty').value, sikSayisi: document.getElementById('set-sik-sayisi').value };
        if(isMistakeMode) { settings.isMistakeMode = true; settings.mistakeList = getLocalData('kpss_wrongs').map(q => q.soru); }
        socket.emit('startGame', { roomCode: myCode, settings: settings }); 
    }

    function finishExamEarly() { if(confirm("Sƒ±navƒ± bitirmek istiyor musun?")) { socket.disconnect(); socket.connect(); let totalScore = 0, correctCount = 0, wrongCount = 0; gameHistory.forEach(g => { if(g.earnedPoints) { totalScore += g.earnedPoints; correctCount++; } else if(g.userAnswerIndex !== -1 && !g.isCorrect) { totalScore -= 5; wrongCount++; } }); renderResultScreen([{ username: getUsername() || "Ben", score: totalScore }], correctCount, wrongCount); } }
    function submitBlank() { socket.emit('submitAnswer', {roomCode: myCode, answerIndex: -1}); disableAllButtons(); }
    function disableAllButtons() { myButtons.forEach(x => x.disabled = true); document.getElementById('btn-blank').disabled = true; }

    function showReviewScreen() {
        const container = document.getElementById('review-content'); container.innerHTML = "";
        if (gameHistory.length === 0) { container.innerHTML = "<p>Veri yok.</p>"; showScreen('screen-review'); return; }
        gameHistory.forEach((item, index) => {
            const q = item.question; const userAns = item.userAnswerIndex === -1 ? "BO≈û" : q.siklar[item.userAnswerIndex]; const correctAns = q.siklar[item.correctAnswerIndex]; const statusClass = item.isCorrect ? "text-green" : "text-red"; const statusIcon = item.isCorrect ? "‚úÖ" : (item.userAnswerIndex === -1 ? "‚ö™" : "‚ùå"); const solutionHTML = q.cozum ? `<div class="review-solution">üí° <b>√á√∂z√ºm:</b> ${q.cozum}</div>` : "";
            container.innerHTML += `<div class="review-card"><div class="review-q">${index + 1}. ${q.soru}</div><div class="review-row"><span>Senin Cevabƒ±n:</span><span class="${statusClass} review-user-ans">${statusIcon} ${userAns}</span></div><div class="review-row"><span>Doƒüru Cevap:</span><span class="review-correct-ans">${correctAns}</span></div>${solutionHTML}</div>`;
        });
        showScreen('screen-review');
    }

    function renderResultScreen(playerList, myCorrect=0, myWrong=0) {
        showScreen('screen-result'); clearInterval(globalTimerInterval); 
        playerList.sort((a,b) => b.score - a.score);
        document.getElementById('result-board').innerHTML = playerList.map((x,i) => `<div class="player-card"><span>${i+1}. ${x.username}</span><span>${x.score} P</span></div>`).join('');
        const myResult = playerList.find(p => p.username === (getUsername() || "Ben"));
        if(myResult) {
            totalUserPoints += myResult.score; localStorage.setItem('kpss_total_points', totalUserPoints); updateRankDisplay();
            let history = getLocalData('kpss_game_history'); history.push({ date: new Date().toLocaleDateString() + " " + new Date().toLocaleTimeString().slice(0,5), score: myResult.score, correct: myCorrect, wrong: myWrong }); saveLocalData('kpss_game_history', history);
        }
        const stats = {}; gameHistory.forEach(item => { const ders = item.question.ders || "Genel"; if(!stats[ders]) stats[ders] = { dogru: 0, toplam: 0 }; stats[ders].toplam++; if(item.isCorrect) stats[ders].dogru++; });
        let analysisHTML = "<h4 style='margin:0 0 10px 0; color:#1e3c72;'>üìä Bran≈ü Ba≈üarƒ± Analizi</h4>";
        if(Object.keys(stats).length === 0) analysisHTML += "<p>Veri yok.</p>"; else { for(let ders in stats) { const yuzde = Math.round((stats[ders].dogru / stats[ders].toplam) * 100); const color = yuzde >= 70 ? "#27ae60" : (yuzde >= 40 ? "#e67e22" : "#c0392b"); analysisHTML += `<div class="analysis-item"><span>${ders}</span><span style="color:${color}; font-weight:bold;">%${yuzde} Ba≈üarƒ± (${stats[ders].dogru}/${stats[ders].toplam})</span></div>`; } }
        document.getElementById('branch-analysis').innerHTML = analysisHTML; confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
    }

    function renderNavigator(total, currentIndex) {
        const navDiv = document.getElementById('question-navigator'); navDiv.innerHTML = "";
        for(let i=0; i<total; i++) { const box = document.createElement('div'); box.className = 'nav-box'; box.innerText = i + 1; if(i === currentIndex) box.classList.add('active'); if(questionStatusList[i]) { if(questionStatusList[i].result === 'correct') box.classList.add('correct'); else if(questionStatusList[i].result === 'wrong') box.classList.add('wrong'); else box.classList.add('answered'); } box.onclick = () => { if(isTrialMode) socket.emit('jumpToQuestion', { roomCode: myCode, index: i }); }; navDiv.appendChild(box); }
    }
    function navigateQuestion(direction) { if(!currentQuestionData) return; socket.emit('jumpToQuestion', { roomCode: myCode, index: (currentQuestionData.index - 1) + direction }); }
    function startGlobalCountdown(seconds) { clearInterval(globalTimerInterval); let timeLeft = seconds; function updateDisplay() { let m = Math.floor(timeLeft / 60); let s = timeLeft % 60; document.getElementById('gen-timer-val').innerText = `${m}:${s < 10 ? '0'+s : s}`; } updateDisplay(); globalTimerInterval = setInterval(() => { timeLeft--; updateDisplay(); if(timeLeft <= 0) clearInterval(globalTimerInterval); }, 1000); }

    socket.on('roomCreated', c => { myCode = c; document.getElementById('display-room-code').innerText = isTrialMode ? (isMistakeMode ? "HATA ANALƒ∞Z" : "Bƒ∞REYSEL DENEME") : c; document.getElementById('room-info-text').innerText = isTrialMode ? "Mod:" : "Oda Kodu:"; showScreen('screen-lobby'); document.getElementById('host-controls').style.display = 'block'; if(isTrialMode) { document.getElementById('wait-msg').style.display = 'none'; if(isMistakeMode) document.getElementById('set-count').value = Math.min(10, getLocalData('kpss_wrongs').length); } });
    socket.on('updateDenemeList', (data) => { const container = document.getElementById('deneme-content'); container.innerHTML = ''; const allDiv = document.createElement('div'); allDiv.className = 'checkbox-item'; allDiv.style.backgroundColor = '#f0f8ff'; allDiv.innerHTML = `<input type="checkbox" id="cb-all" checked onchange="toggleAllDeneme(this)"><label for="cb-all"><strong>T√úM√úN√ú SE√á / KALDIR</strong></label>`; container.appendChild(allDiv); if (data.ozgunSayi > 0) { const ozgunDiv = document.createElement('div'); ozgunDiv.className = 'checkbox-item'; ozgunDiv.style.borderBottom = '2px solid #e67e22'; ozgunDiv.innerHTML = `<input type="checkbox" name="deneme-secim" id="cb-ozgun" value="OZGUN_SORULAR" checked onchange="updateTriggerText('deneme-content', 'T√ºm Kaynaklar')"><label for="cb-ozgun">‚ú® √ñzg√ºn Sorular (${data.ozgunSayi} Soru)</label>`; container.appendChild(ozgunDiv); } Object.keys(data.denemeler).sort().reverse().forEach((denemeAdi, index) => { const div = document.createElement('div'); div.className = 'checkbox-item'; const adet = data.denemeler[denemeAdi]; div.innerHTML = `<input type="checkbox" name="deneme-secim" id="cb-${index}" value="${denemeAdi}" checked onchange="updateTriggerText('deneme-content', 'T√ºm Kaynaklar')"><label for="cb-${index}">${denemeAdi} (${adet} Soru)</label>`; container.appendChild(div); }); updateTriggerText('deneme-content', 'T√ºm Kaynaklar'); });
    socket.on('updateSubjectList', (liste) => { const container = document.getElementById('subject-content'); container.innerHTML = ''; const allDiv = document.createElement('div'); allDiv.className = 'checkbox-item'; allDiv.style.backgroundColor = '#f0f8ff'; allDiv.innerHTML = `<input type="checkbox" id="sub-all" checked onchange="toggleAllSubjects(this)"><label for="sub-all"><strong>T√úM√úN√ú SE√á / KALDIR</strong></label>`; container.appendChild(allDiv); liste.forEach((dersAdi, index) => { const div = document.createElement('div'); div.className = 'checkbox-item'; div.innerHTML = `<input type="checkbox" name="subject-secim" id="sub-${index}" value="${dersAdi}" checked onchange="updateTriggerText('subject-content', 'T√ºm Dersler')"><label for="sub-${index}">${dersAdi}</label>`; container.appendChild(div); }); updateTriggerText('subject-content', 'T√ºm Dersler'); });
    function toggleAllDeneme(source) { document.querySelectorAll('input[name="deneme-secim"]').forEach(cb => cb.checked = source.checked); updateTriggerText('deneme-content', 'T√ºm Kaynaklar'); }
    function toggleAllSubjects(source) { document.querySelectorAll('input[name="subject-secim"]').forEach(cb => cb.checked = source.checked); updateTriggerText('subject-content', 'T√ºm Dersler'); }
    socket.on('roomJoined', c => { myCode=c; document.getElementById('display-room-code').innerText=c; showScreen('screen-lobby'); document.getElementById('wait-msg').style.display='block'; });
    socket.on('updatePlayerList', p => { const h = p.map(x => `<div class="player-card"><span>${x.username}</span><span>${x.score}</span></div>`).join(''); document.getElementById('lobby-list').innerHTML = isTrialMode ? "" : h; document.getElementById('live-scores-list').innerHTML = h; });
    socket.on('newQuestion', d => { if (!questionStatusList || questionStatusList.length !== d.total) { gameHistory = []; questionStatusList = new Array(d.total).fill(null); } showScreen('screen-game'); document.getElementById('result-msg').innerText = ""; currentQuestionData = { ...d, dogru: null }; if(isTrialMode) { document.getElementById('question-navigator').style.display = 'grid'; document.getElementById('nav-buttons').style.display = 'flex'; document.getElementById('live-scores-container').style.display = 'none'; renderNavigator(d.total, d.index - 1); } else { document.getElementById('question-navigator').style.display = 'none'; document.getElementById('nav-buttons').style.display = 'none'; document.getElementById('live-scores-container').style.display = 'block'; } document.getElementById('star-btn').classList.toggle('starred', !!getLocalData('kpss_favs').find(q => q.soru === d.soru)); document.getElementById('q-lesson').innerText = d.ders + (d.zorluk ? ` (${d.zorluk})` : ""); document.getElementById('q-count').innerText = d.index + "/" + d.total; document.getElementById('q-text').innerText = d.soru; const img = document.getElementById('q-image'); if(d.resim) { img.src = d.resim.startsWith('http') ? d.resim : '/img/' + d.resim; img.style.display = 'block'; } else { img.style.display = 'none'; } const area = document.getElementById('opts-area'); area.innerHTML = ""; myButtons = []; d.siklar.forEach((s, i) => { const b = document.createElement('button'); b.className = 'opt-btn'; b.innerText = s; const status = questionStatusList[d.index - 1]; if(status && i === status.selectedIndex) { if(status.result === 'correct') b.classList.add('correct'); else b.classList.add('wrong'); } b.onclick = () => { if(questionStatusList[d.index - 1]) return; socket.emit('submitAnswer', {roomCode: myCode, answerIndex: i}); disableAllButtons(); }; area.appendChild(b); myButtons.push(b); }); if(questionStatusList[d.index - 1]) disableAllButtons(); else document.getElementById('btn-blank').disabled = false; const timerBar = document.getElementById('timer-bar'); const genTimer = document.getElementById('general-timer-display'); if (d.timerMode === 'question') { timerBar.style.display = 'block'; genTimer.style.display = 'none'; timerBar.style.transition = 'none'; timerBar.style.width = '100%'; setTimeout(() => { timerBar.style.transition = `width ${d.duration}s linear`; timerBar.style.width = '0%'; }, 50); } else { timerBar.style.display = 'none'; genTimer.style.display = 'block'; if (d.index === 1 && d.remainingTime) startGlobalCountdown(d.remainingTime); } });
    socket.on('answerResult', d => { if(currentQuestionData) { questionStatusList[currentQuestionData.index - 1] = { selectedIndex: d.selectedIndex, result: d.correct ? 'correct' : (d.selectedIndex === -1 ? 'blank' : 'wrong') }; if(isTrialMode) renderNavigator(currentQuestionData.total, currentQuestionData.index - 1); } if (currentQuestionData) { currentQuestionData.dogru = d.correctIndex; saveToHistory(currentQuestionData, 'kpss_favs'); gameHistory.push({ question: currentQuestionData, userAnswerIndex: d.selectedIndex, isCorrect: d.correct, correctAnswerIndex: d.correctIndex, earnedPoints: d.points }); if(isMistakeMode && d.correct) { let wrongs = getLocalData('kpss_wrongs'); wrongs = wrongs.filter(q => q.soru !== currentQuestionData.soru); saveLocalData('kpss_wrongs', wrongs); } else if (!d.correct && !isMistakeMode && d.selectedIndex !== -1) { saveToHistory(currentQuestionData, 'kpss_wrongs'); } } if(d.points > 0) { document.getElementById('result-msg').innerText = `+${d.points} Puan!`; playSnd('snd-correct'); } if(d.isBlank) { myButtons[d.correctIndex].classList.add('correct'); saveToHistory(currentQuestionData, 'kpss_blanks'); } else { const btn = myButtons[d.selectedIndex]; if(d.correct) { btn.classList.add('correct'); } else { btn.classList.add('wrong'); playSnd('snd-wrong'); myButtons[d.correctIndex].classList.add('correct'); } } });
    socket.on('gameOver', p => { renderResultScreen(p, 0, 0); questionStatusList = []; });
    socket.on('errorMsg', m => alert(m));
</script>
</body>
</html>
